<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="@ZHAW Init">
<title>Lösungen zu den Übungen Concurrency – Cooperation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article">
<div id="header">
<h1><span class="image right"><img src="./images/PROG2-300x300.png" alt="IT.PROG2" width="100" height="100"></span> Lösungen zu den Übungen Concurrency – Cooperation</h1>
<div class="details">
<span id="author" class="author">@ZHAW Init</span><br>
<span id="revnumber">version FS2023,</span>
<span id="revdate">2023-03-25</span>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_concurrency_3thread_synchronisation">1. Concurrency 3&#8201;&#8212;&#8201;Thread Synchronisation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_konto_übertrag_pu">1.1. Konto-Übertrag [PU]</h3>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Was stellen Sie fest, wenn Sie die Simulation laufen lassen?
Erklären Sie wie die Abweichungen zustande kommen.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Bei den Transaktionen passieren sog. <em>lost updates</em>. Eine Transaktion ist nicht atomar und besteht aus mehreren Schritten (Wert aus Speicher lesen, verändern, Wert in Speicher schreiben).
Durch die gleichzeitige Operation auf den Konten aus mehreren Threads können einzelne dieser Schritte ignoriert werden und verloren gehen.
Beide Threads Lesen den gleichen Wert, aktualisieren diesen gleichzeitig, schreiben das neue Resultat (der letzte gewinnt).
Am Schluss ist die Geldsumme über alle drei Konten oft grösser oder kleiner als am Anfang.</p>
</div>
</div>
</div>
</li>
<li>
<p>Im Unterricht haben Sie gelernt, dass kritische Bereiche Ihres Codes durch Mutual-Exclusion geschützt werden sollen.
Wie macht man das in Java?</p>
<div class="paragraph">
<p>Versuchen Sie mittels von Mutual-Exclusion sicherzustellen, dass keine Abweichungen entstehen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reicht es die kritischen Bereiche in Account zu sichern?</p>
</li>
<li>
<p>Welches sind die kritischen Bereiche?</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Klasse: <code>Account</code></p>
</div>
<div class="paragraph">
<p>Monitor Objekte müssen so gewählt werden, dass sie die 'geteilten' Ressourcen schützen. Oft ist deshalb
die geteilte Ressource selber das Monitor Objekt.<br>
In diesem Fall wären es die <code>Account</code>-Objekte auf welche die von verschiedenen Threads zugegriffen wird.<br>
Den Thread selber als Monitor zu verwenden macht wenig Sinn, da dann jeder Thread seinen eigenen Monitor besitzen würde.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Der Monitor von Thread-Objekten wird intern für <code>Thread.join()</code> verwendet. Beim Beenden eines Threads werden mit <code>notifyAll()</code> alle in einem <code>join()</code> wartenden Threads informiert. Deshalb sollte auf Thread-Instanzen niemals <code>wait()</code>, <code>notify()</code> oder <code>notifyAll()</code> verwendet werden. Siehe <a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/Thread.html#join(long,int)">JavaDoc von Thread.join()</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kritische Bereiche sind diejenigen, in welchen auf eine geteilte Variable zugegriffen wird.
Das kann sowohl schreibend, wie auch lesend erfolgen. Auch lesende Zugriffe sollten geschützt werden, da sonst nicht sichergestellt werden kann, dass der Wert während des Lesens nicht von einem anderen Thread verändert wird.<br>
In <code>Account</code> sollte deshalb sowohl die Methode <code>setBalance(int amount)</code> wie auch <code>getBalance()</code> als <code>synchronized</code> deklariert werden.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Untersuchen Sie mehrere Varianten von Locks (Lock auf Methode oder Block,
Lock auf Instanz oder Klasse).</p>
</div>
<div class="paragraph">
<p>Ihre Implementierung muss noch nebenläufige Transaktionen erlauben, d.h. wenn
Sie zu stark synchronisieren, werden alle Transaktionen in Serie ausgeführt und
Threads ergeben keinen Sinn mehr.</p>
</div>
<div class="paragraph">
<p>Stellen Sie für sich folgende Fragen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Welches ist das Monitor-Objekt?</p>
</li>
<li>
<p>Braucht es eventuell das Lock von mehr als einem Monitor, damit eine Transaktion ungestört ablaufen kann?</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Klasse: <code>AccountTransferTask</code></p>
</div>
<div class="paragraph">
<p>Auch in <code>AccountTransferTask</code> ist immer noch <code>Account</code> das Monitor-Objekt, da dort die Daten effektiv verändert werden. Da in <code>transfer()</code> jedoch gleichzeitig mit zwei Konten gearbeitet wird, sollte sichergestellt werden, dass nur ein Thread auf exakt die beiden Konten Zugriff hat, damit die Überprüfung und Abbuchung von einem Konto und der Übertrag auf das Andere als eine atomare Funktion erfolgt.
Das heißt wir erhalten einen neuen <em>kritischen Bereich</em> den wir mit synchronized schützen müssen.
Diesmal in dem der Monitor von <code>fromAccount</code> und <code>toAccount</code> im Voraus schon akquiriert und somit sicherstellt wird, dass <code>transferAmmount</code> von beiden Konten nicht mehr blockieren kann.<br>
In Java kann das mit einer geschachtelten Synchronisation erfolgen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="Java"> synchronized(fromAccount) {
     synchronized(toAccount) {
         if (fromAccount.getBalance() &gt;= amount) {
             fromAccount.transferAmount(-amount);
             toAccount.transferAmount(amount);
         }
     }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Warum kann man nicht einfach die Methode <code>transfer()</code> synchronized deklarieren?<br>
Damit würde die <code>AccountTransferTask</code>-Instanz selber als drittes Monitor-Objekt verwendet.
Damit werden nur die Threads synchronisiert, welche das gleiche Task-Objekt verwenden.
Da drei Task-Objekte erstellt werden, könnten zum Beispiel je ein Thread für <code>task2</code> und <code>task3</code> gleichzeitig auf <code>account2</code> zugreifen.
Würde für jede Transaktion sogar eine eigene <code>AccountTransferTask</code>-Instanz erzeugt, hätte das synchronized auf <code>transfer()</code> überhaupt keinen Effekt mehr, da dann jeder Thread seinen eigenen Monitor besitzt.</p>
</div>
</div>
</div>
</li>
<li>
<p>Wenn Sie es geschafft haben die Transaktion thread-safe zu implementieren,
  ersetzen Sie in <code>AccountTransferSimulation</code> die folgende Zeile:<br>
  <code>AccountTransferTask task1 = new AccountTransferTask(account<strong>3</strong>, account<strong>1</strong>, 2);</code><br>
durch<br>
<code>AccountTransferTask task1 = new AccountTransferTask(account<strong>1</strong>, account<strong>3</strong>, 2);</code><br>
und starten Sie das Programm noch einmal. Was stellen Sie fest?
(evtl. müssen Sie mehrfach neu starten, damit der Effekt auftritt).<br>
Was könnte die Ursache sein und wie können Sie es beheben?<br></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Falls Sie die Frage noch nicht beantworten können, kommen sie nach der Vorlesung "Concurrency 4" nochmals auf diese Aufgabe zurück und versuchen Sie sie dann zu lösen.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Durch die Umstellung kann es zu einem zirkulären Deadlock kommen, da sich die Threads gegenseitig blockieren (jeder hat ein Konto bereits gelockt und wartet auf ein anderes).</p>
</div>
<div class="paragraph">
<p>Die einfachste Lösung ist es die Konten immer in einer übergeordneten festen Reihenfolge zu akquirieren.
In diesem Fall zum Beispiel immer zuerst die tiefere Kontonummer.
Dadurch kann es keine zirkulären Abhängigkeiten mehr geben.</p>
</div>
<div class="paragraph">
<p>Lösung: <code>AccountTransferTask.transferDLfree()</code></p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_traffic_light_pu">1.2. Traffic Light [PU]</h3>
<div class="paragraph">
<p>In dieser Aufgabe sollen Sie die Funktionsweise einer Ampel und deren Nutzung nachahmen.
Benutzen Sie hierzu die Vorgabe im Modul <code>TrafficLight</code>.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ergänzen Sie zunächst in der Klasse <code>TrafficLight</code> drei Methoden:</p>
<div class="ulist">
<ul>
<li>
<p>Eine Methode zum Setzen der Ampel auf "rot".</p>
</li>
<li>
<p>Eine Methode zum Setzen der Ampel auf "grün".</p>
</li>
<li>
<p>Eine Methode mit dem Namen <code>passby()</code>. Diese Methode soll das Vorbeifahren
eines Fahrzeugs an dieser Ampel nachbilden: Ist die Ampel rot, so wird der
aufrufende Thread angehalten, und zwar so lange, bis die Ampel grün wird.
Ist die Ampel dagegen grün, so kann der Thread sofort aus der Methode zurückkehren,
ohne den Zustand der Ampel zu verändern. Verwenden Sie <code>wait</code>, <code>notify</code> und
<code>notifyAll</code> nur an den unbedingt nötigen Stellen!</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Die Zwischenphase „gelb“ spielt keine Rolle – Sie können diesem Zustand ignorieren!
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Lösung siehe: <code>ch.zhaw.prog2.trafficlight.TrafficLight</code></p>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Erweitern Sie nun die Klasse <code>Car</code> (abgeleitet von <code>Thread</code>).<br>
Im Konstruktor wird eine Referenz auf ein Feld von Ampeln übergeben.
Diese Referenz wird in einem entsprechenden Attribut der Klasse <code>Car</code> gespeichert.
In der <code>run</code>-Methode werden alle Ampeln dieses Feldes passiert, und zwar in einer Endlosschleife (d.h. nach dem Passieren der letzten Ampel des Feldes wird wieder die erste Ampel im Feld passiert).<br>
Natürlich darf das Auto erst dann eine Ampel passieren, wenn diese auf grün ist!<br>
Für die Simulation der Zeitspanne für das Passieren des Signals sollten Sie folgende Anweisung verwenden: <code>sleep((int)(Math.random() * 500));</code></p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Lösung Siehe: <code>ch.zhaw.prog2.trafficlight.Car</code></p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Beantworten Sie entweder (c) oder (d) (nicht beide):</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a" start="3">
<li>
<p>Falls Sie bei der Implementierung der Klasse TrafficLight die Methode
<code>notifyAll()</code> benutzt haben:<br>
Hätten Sie statt <code>notifyAll</code> auch die Methode <code>notify</code> verwenden können, oder haben Sie <code>notifyAll()</code> unbedingt gebraucht?
Begründen Sie Ihre Antwort!</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Mit <code>notifyAll()</code> erhalten alle Autos die Gelegenheit die Ampel zu überqueren.
Natürlich betreten sie den Monitor (<code>TrafficLight</code>) immer noch einzeln und können, falls die Zeitspanne nicht, reicht trotzdem stehen bleiben. Dann erhalten Sie bei der nächsten "Grünen Welle" erneut eine Notifikation und können es nochmals probieren.</p>
</div>
<div class="paragraph">
<p>Bei <code>notify()</code> würde immer nur ein Auto an der Ampel losfahren.<br>
Man könnte das beheben, indem jedes Auto vor dem Losfahren noch ein weiteres <code>notify()</code> erzeugt.
Das ist aber eher ein work-around und nicht sehr schön.</p>
</div>
</div>
</div>
</li>
<li>
<p>Falls Sie bei der Implementierung der Klasse Ampel die Methode <code>notify()</code> benutzt
haben:<br>
Begründen Sie, warum <code>notifyAll()</code> nicht unbedingt benötigt wird!</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe oben.</p>
</div>
</div>
</div>
</li>
<li>
<p>Testen Sie das Programm <code>TrafficLightOperation.java</code>.
Die vorgegebene Klasse implementiert eine primitive Simulation von Autos, welche die Ampeln passieren.
Studieren Sie den Code dieser Klasse und überprüfen Sie, ob die erzeugte Ausgabe sinnvoll ist.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_producer_consumer_problem_pu">1.3. Producer-Consumer Problem [PU]</h3>
<div class="paragraph">
<p>In dieser Aufgabe wird ein Producer-Consumer Beispiel mittels einer Queue umgesetzt.</p>
</div>
<div class="paragraph">
<p>Dazu wird eine Implementation mittels eines <a href="https://en.wikipedia.org/wiki/Circular_buffer">Digitalen Ringspeichers</a> umgesetzt.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://en.wikipedia.org/wiki/Circular_buffer"><img src="./images/Circular_Buffer_Animation.gif" alt="Circular Buffer Animation" width="600px"></a>
</div>
<div class="title">Figure 1. Circular Buffer [Wikipedia]</div>
</div>
<div class="paragraph">
<p>Hierzu sind zwei Klassen (<code>CircularBuffer.java</code>, <code>Buffer.java</code>) vorgegeben, mit folgendem Design:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/CircularBuffer.png" alt="CircularBuffer" width="600px">
</div>
<div class="title">Figure 2. Circular Buffer Design</div>
</div>
<div class="sect3">
<h4 id="_analyse_der_abgegebenen_circularbuffer_umsetzung">Analyse der abgegebenen CircularBuffer Umsetzung.</h4>
<div class="paragraph">
<p>Mit dem Testprogramm <code>CircBufferSimulation</code> kann die Funktion der <code>CircularBuffer</code> Implementierung analysiert werden.
Der mitgelieferte <code>Producer</code>-Thread generiert kontinuierlich Daten (in unserem Fall aufsteigende Nummern) und füllt diese mit <code>buffer.put(&#8230;&#8203;)</code> in den Buffer.
Der <code>Consumer</code>-Thread liest die  Daten kontinuierlich mit <code>buffer.get()</code> aus dem Buffer aus.
Beide Threads benötigen eine gewisse Zeit zum Produzieren bzw. Konsumieren der Daten.
Diese kann über die Variablen <code>maxProduceTime</code> bzw. <code>maxConsumeTime</code> beeinflusst werden.
Es können zudem mehrere Producer- bzw. Consumer-Threads erzeugt werden.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Starten Sie <code>CircularBufferSimulation</code> und analysieren Sie die Ausgabe.
Der Status des Buffers (belegte Positionen und Füllstand) wird sekündlich ausgegeben.
Alle fünf Sekunden wird zudem der aktuelle Inhalt des Buffers ausgegeben.<br></p>
<div class="ulist">
<ul>
<li>
<p>Wie ist das Verhalten des <code>CircularBuffer</code> bei den Standard-Testeinstellungen?</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><code>Producer</code> und <code>Consumer</code> arbeiten etwa im gleichen Rhythmus.
Das heißt der Buffer ist immer leicht gefüllt, aber nie ganz voll oder leer.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Analysieren Sie die Standard-Einstellungen in <code>CircularBufferSimulation</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Welche Varianten gibt es, die Extrempositionen (Buffer leer, bzw. Buffer voll) zu erzeugen?</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Damit der Buffer immer etwa gleich gefüllt ist und alles reibungslos funktioniert muss
<code>prodCount * maxProducetime ≈ consCount * maxConsumeTime</code> sein.
Das heißt es wird gleichviel produziert, wie konsumiert.</p>
</div>
<div class="paragraph">
<p><strong>Buffer leer</strong> → es wird mehr konsumiert als produziert</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mehr Zeit für Produktion: <code>maxProduceTime</code> &gt; <code>maxConsumeTime</code> setzen.</p>
</li>
<li>
<p>Mehr Konsumenten als Produzenten: <code>prodCount</code> &lt; <code>consCount</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Buffer voll</strong> → es wird mehr produziert als konsumiert</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mehr Zeit für Konsumation: <code>maxProduceTime</code> &lt; <code>maxConsumeTime</code> setzen.</p>
</li>
<li>
<p>Mehr Produzenten als Konsumenten: <code>prodCount</code> &gt; <code>consCount</code></p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Was ist das erwartete Verhalten bei vollem bzw. leerem Buffer? (bei Producer bzw. Consumer)</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Buffer leer</strong> → <code>Consumer</code> muss warten, bis wieder Daten vorhanden sind.<br>
<strong>Buffer voll</strong> → <code>Producer</code> muss warten, bis wieder Platz für Daten vorhanden ist</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Testen Sie was passiert, wenn der Buffer an die Kapazitätsgrenze kommt. Passen Sie dazu die Einstellungen in <code>CircularBufferSimulation</code> entsprechend an.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Belassen Sie die Anzahl Producer-Threads vorerst auf 1, damit der Inhalt des Buffers (Zahlenfolge) einfacher verifiziert werden kann.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Was Stellen Sie fest? Was passiert wenn der Buffer voll ist? Warum?</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Damit es einfacher verfolgt werden kann, sollte nur <code>maxProduceTime</code> verkleinert bzw. <code>maxConsumeTime</code> vergrössert werden.</p>
</div>
<div class="paragraph">
<p>Sobald der Buffer voll ist, werden die neue produzierten Daten <em>ignoriert</em>; d.h. sozusagen weggeworfen.
Das ist gut an den Lücken in der Zahlenfolge im Buffer zu erkennen.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Wiederholen Sie das Gleiche für einen leeren Buffer. Passen Sie die Einstellungen so an, dass der Buffer sicher leer wird, d.h. der <code>Consumer</code> keine Daten vorfindet.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Geben Sie gegebenenfalls die gelesenen Werte des Konsumenten-Threads aus.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Was stellen Sie fest, wenn der Buffer leer ist? Warum?</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Damit man den Effekt sehen kann, muss im <code>Consumer</code> der Inhalt des konsumierten Strings ausgegeben werden.
Sie stellen fest, dass <code>null</code>-Werte geliefert werden, sobald der Buffer leer ist.
Es werden also <em>Fake-Daten</em> konsumiert bzw. weiterverarbeitet.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_thread_safe_circular_buffer">Thread-Safe Circular Buffer</h4>
<div class="paragraph">
<p>In der vorangehenden Übung griffen mehrere Threads (<code>Producer</code> &amp; <code>Consumer</code>) auf den gleichen Buffer zu.
Die Klasse <code>CircularBuffer</code> ist aber nicht thread-safe.
Deshalb soll jetzt eine Wrapper Klasse geschrieben werden, welche die CircularBuffer-Klasse "thread-safe" macht.
Das führt zu folgendem Design:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/GuardedCircularBuffer.png" alt="GuardedCircularBuffer" width="600px">
</div>
<div class="title">Figure 3. Guarded Circular Buffer Design</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Beachten Sie, dass es sich hier um einen Wrapper (keine Vererbung) handelt.<br>
Der <code>GuardedCircularBuffer</code> hält eine Referenz auf ein <code>CircularBuffer</code>-Objekt welches er im Hintergrund für die Speicherung verwendet. Das heißt, viele Methodenaufrufe werden einfach an das gekapselte Objekt weitergeleitet. Einzelne Methoden werden jedoch in ihrer Funktion erweitert. Man spricht auch von "Dekorieren" des Original-Objektes (siehe <a href="{decorator-pattern}">Decorator-Pattern</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a" start="5">
<li>
<p>Ergänzen Sie die vorhandene Klasse <code>GuardedCircularBuffer</code> sodass:</p>
<div class="ulist">
<ul>
<li>
<p>Die Methoden <code>empty</code>, <code>full</code>, <code>count</code> das korrekte Resultat liefern.</p>
</li>
<li>
<p>Aufrufe von <code>put</code> blockieren, solange der Buffer voll ist, d.h. bis mindestens wieder ein leeres Buffer-Element vorhanden ist.</p>
</li>
<li>
<p>Analog dazu Aufrufe von <code>get</code> blockieren, solange der Buffer leer ist, d.h, bis mindestens ein Element im Buffer vorhanden ist.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Verwenden Sie den Java Monitor des <code>GuardedCircularBuffer</code>-Objektes!
Wenn die Klasse fertig implementiert ist, soll sie in der <code>CircBufferSimulation</code> Klasse verwendet werden.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Lösung: <code>ch.zhaw.prog2.circularbuffer.GuardedCircularBuffer</code></p>
</div>
<div class="paragraph">
<p>Als erstes müssen sicher die Methoden <code>get</code> und <code>put</code> als <code>synchronized</code> deklariert werden.
Da jedoch auch die anderen Methoden auf den Status des Buffers zugreifen, müssen auch diese <code>synchronized</code> sein.</p>
</div>
<div class="paragraph">
<p>Bei <code>get</code> und <code>put</code> wird jeweils in einer <code>while</code>-Schleife der Zustand überprüft und falls nicht erfüllt (<code>get</code> → buffer leer, <code>put</code> → buffer voll) mit <code>wait()</code> gewartet.</p>
</div>
<div class="paragraph">
<p>Sobald ein Element hinzugefügt bzw. gelesen wurde, werden die wartenden <code>Consumer</code> oder <code>Producer</code> Threads mit <code>notify()/notifyAll()</code> benachrichtigt.</p>
</div>
<div class="paragraph">
<p>Die eigentlichen Operationen werden auf einem gekapselten <code>CircularBuffer</code>-Objekt ausgeführt, welches im Konstruktor erzeugt wird.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Beantworten Sie entweder (i) oder (ii) (nicht beide):</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Falls Sie bei der Implementierung der Klasse <code>GuardedCircularBuffer</code> die Methode <code>notifyAll()</code> benutzt haben:
Hätten Sie statt <code>notifyAll()</code> auch die Methode <code>notify()</code> verwenden können oder haben Sie <code>notifyAll()</code> unbedingt
benötigt? Begründen Sie Ihre Antwort!</p>
</li>
<li>
<p>Falls Sie bei der Implementierung der Klasse <code>GuardedCircularBuffer</code> die Methode <code>notify()</code> benutzt haben:
Begründen Sie, warum Sie <code>notifyAll()</code> nicht unbedingt benötigten!</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Da bei vernünftiger Dimensionierung des Buffers &amp; der Anzahl Threads, sollten jeweils nur entweder Produzenten oder Konsumenten am Warten sein.
Dann reicht beim Entfernen bzw. Hinzufügen eines Elementes ein <code>notify()</code>.
Es wird dann einer der wartenden Threads aufgeweckt, der ein Element hinzufügen bzw. entfernen kann.
Beim nächsten Hinzufügen bzw. Entfernen wird ja wieder eine neue Notifikation erzeugt.</p>
</div>
<div class="paragraph">
<p>Wenn der Buffer aber sehr klein und die Zahl der Produzenten / Konsumenten gross ist, könnte der Fall auftreten, dass sowohl Konsumenten, wie auch Produzenten am Warten sind.</p>
</div>
<div class="paragraph">
<p>Um sicherzugehen, dass sicher ein Produzent bzw. Konsument zum Zug kommt, wecken wir deshalb am besten alle wartenden Threads.</p>
</div>
<div class="paragraph">
<p>Das hat aber den Nachteil, dass alle ihre Bedingung überprüfen müssen, obwohl nur der erste passende Thread zum Zuge kommt, da ja nur ein Platz frei wurde, der gefüllte bzw. ein Element vorhanden ist, das abgeholt werden kann.</p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concurrency_4lock_conditions_deadlocks">2. Concurrency 4&#8201;&#8212;&#8201;Lock &amp; Conditions, Deadlocks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_single_lane_bridge_pu">2.1. Single-Lane Bridge [PU]</h3>
<div class="paragraph">
<p>Die Brücke über einen Fluss ist so schmal, dass Fahrzeuge nicht kreuzen können.
Sie soll jedoch von beiden Seiten überquert werden können.
Es braucht somit eine Synchronisation, damit die Fahrzeuge nicht kollidieren.
Um das Problem zu illustrieren wird eine fehlerhaft funktionierende Anwendung,
in welcher keine Synchronisierung vorgenommen wird, zur Verfügung gestellt.
Ihre Aufgabe ist es, die Synchronisation der Fahrzeuge einzubauen.</p>
</div>
<div class="paragraph">
<p>Die Anwendung finden Sie im <a href="../code/">Praktikumsverzeichnis</a> im Modul <code>Bridge</code>.
Gestartet wird sie indem die Klasse <code>Main</code> ausgeführt wird (z.B. mit <code>gradle run</code>).
Das GUI sollte selbsterklärend sein.
Mit den zwei Buttons können sie Autos links bzw. rechts hinzufügen. Sie werden feststellen, dass die Autos auf der Brücke kollidieren, bzw. illegalerweise durcheinander hindurchfahren.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bridge_overview.png" alt="bridge overview" width="600px">
</div>
<div class="title">Figure 4. Single-Lane Bridge GUI</div>
</div>
<div class="paragraph">
<p>Um das Problem zu lösen, müssen Sie die den GUI Teil der Anwendung nicht verstehen.
Sie müssen nur wissen, dass Fahrzeuge, die von links nach rechts fahren, die Methode <code>controller.enterLeft()</code> aufrufen bevor sie auf die Brücke fahren (um Erlaubnis fragen) und die Methode <code>controller.leaveRight()</code> aufrufen, sobald sie die Brücke verlassen.
Fahrzeuge in die andere Richtung rufen entsprechend die Methoden <code>enterRight()</code> und <code>leaveLeft()</code> auf.
Dabei ist <code>controller</code> eine Instanz der Klasse <code>TrafficController</code>, welche für die Synchronisation zuständig ist.
In der mitgelieferten Klasse sind die vier Methoden nicht implementiert (Dummy-Methoden).</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Erweitern sie <code>TrafficController</code> zu einer Monitorklasse, die sicherstellt, dass die Autos nicht mehr kollidieren.
Verwenden Sie dazu den Lock und Conditions Mechanismus.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Verwenden Sie eine Statusvariable, um den Zustand der Brücke zu repräsentieren (e.g. <code>boolean bridgeOccupied</code>).
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Code: <code>ch.zhaw.prog2.bridge.TrafficControllerA</code></p>
</div>
</div>
</div>
</li>
<li>
<p>Passen Sie die Klasse <code>TrafficController</code> so an, dass jeweils abwechslungsweise ein Fahrzeug von links und rechts die Brücke passieren kann.
Unter Umständen wird ein Auto blockiert, wenn auf der anderen Seite keines mehr wartet.
Verwenden Sie für die Lösung mehrere Condition Objekte.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Um die Version aus a. zu behalten, können sie auch eine Kopie (z.B. <code>TrafficControllerB</code>) erzeugen und <code>Main</code> anpassen, damit eine Instanz dieser Klasse verwendet wird.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Code: <code>ch.zhaw.prog2.bridge.TrafficControllerB</code></p>
</div>
</div>
</div>
</li>
<li>
<p>Bauen Sie die Klasse <code>TrafficController</code> so um, dass jeweils alle wartenden Fahrzeuge aus einer Richtung passieren können.
Erst wenn keines mehr wartet, kann die Gegenrichtung fahren.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Mit <a href="{ReentrantLock}"><code>ReentrentLock.hasWaiters(Condition c)</code></a> können Sie
abfragen ob Threads auf eine bestimmte Condition warten.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Siehe Code: <code>ch.zhaw.prog2.bridge.TrafficControllerC</code></p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_the_dining_philosophers_pa">2.2. The Dining Philosophers [PA]</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Die Lösungen zu den bewerteten Pflichtaufgaben erhalten Sie nach der Abgabe und Bewertung aller Klassen.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version FS2023<br>
Last updated 2023-03-25 15:03:13 +0100
</div>
</div>
</body>
</html>